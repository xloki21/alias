version: '3'

tasks:
  generate-mocks:
    cmd: go generate ./...
    desc: "Generate mocks using mockery"

  build:
    cmd: go build -o aliassrv -v ./cmd/main.go
    desc: "Build app"

  test:
    cmd: go test -v ./...
    desc: "Run all tests"

  coverage:
    cmds:
      - go test -coverprofile=coverage.out ./...
      - go tool cover -html=coverage.out -o coverage.html
    desc: "Run tests with coverage and generate HTML report"

  test-with-coverage:
    deps: [ generate-mocks ]
    cmds:
      - task: test
      - task: coverage
    desc: "Generate mocks, run tests, and calculate coverage"

  docker:
    cmd: docker build . -t alias:v1.0.0beta
    desc: "Build docker image"

  integration-test:
    cmds:
      - go clean -testcache
      - go test -tags=integration -v ./internal/tests/...
    desc: "Run integration tests"

  mock-test:
    cmds:
      - task: generate-mocks
      - go test -tags=mock -v ./internal/service/alias/...
    desc: "Run mock tests"

  e2e-test:
    cmds:
      - go test -tags=e2e -v ./internal/tests/...
    desc: "Run e2e tests"
